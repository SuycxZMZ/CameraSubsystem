# CameraSubsystem é¡¹ç›®æ¦‚è§ˆ

## é¡¹ç›®ç®€ä»‹

CameraSubsystem æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½ã€ä½å»¶è¿Ÿã€å¯æ‰©å±•çš„ Camera æ•°æ®æµåŸºåº§ï¼Œä¸“ä¸º RK3576 å¹³å°è®¾è®¡ï¼ˆé¢„ç•™ Android è¿ç§»ï¼‰ã€‚å®ƒä½œä¸º AI æ¨ç†ã€è§†é¢‘ç¼–ç ã€é¢„è§ˆæ˜¾ç¤ºç­‰ä¸Šå±‚åº”ç”¨çš„ç»Ÿä¸€æ•°æ®æ¥æºï¼Œæä¾›é›¶æ‹·è´çš„æ•°æ®ä¼ è¾“èƒ½åŠ›ã€‚

## æ ¸å¿ƒç‰¹æ€§

### æ€§èƒ½ç‰¹æ€§
- **é›¶æ‹·è´ä¼ è¾“**: åŸºäº DMA-BUF å’Œå…±äº«å†…å­˜ï¼Œé¿å… CPU å¯†é›†çš„å†…å­˜æ‹·è´æ“ä½œ
- **ä½å»¶è¿Ÿ**: ç«¯åˆ°ç«¯å»¶è¿Ÿæ§åˆ¶åœ¨ 10ms ä»¥å†… (4K@30fps)
- **é«˜åå**: æ”¯æŒ 4K@60fps é«˜å¸§ç‡ç¨³å®šé‡‡é›†ä¸åˆ†å‘
- **ä½å†…å­˜å ç”¨**: å•è·¯ 4K@30fps å†…å­˜å ç”¨ < 100MB

### å¹¶å‘èƒ½åŠ›
- **å¤š Camera æ”¯æŒ**: æ”¯æŒå¤šè·¯ Camera å¹¶è¡Œé‡‡é›†ï¼ˆè·¯æ•°ç”±å¹³å°èƒ½åŠ›å†³å®šï¼‰
- **å¤šè®¢é˜…è€…**: æ”¯æŒå¤šä¸ªè®¢é˜…è€…åŒæ—¶æ¶ˆè´¹åŒä¸€å¸§æ•°æ®
- **çº¿ç¨‹æ± è°ƒåº¦**: åŠ¨æ€æ‰©å±•çš„çº¿ç¨‹æ± ï¼Œæ”¯æŒ CPU æ ¸å¿ƒæ•°è‡ªé€‚åº”

### ç¨³å®šæ€§
- **RAII èµ„æºç®¡ç†**: ä¸¥æ ¼çš„èµ„æºç®¡ç†ï¼Œæœç»èµ„æºæ³„æ¼
- **çº¿ç¨‹å®‰å…¨**: å®Œå–„çš„åŒæ­¥æœºåˆ¶ï¼Œé¿å…æ­»é”å’Œç«æ€æ¡ä»¶
- **é”™è¯¯æ¢å¤**: å®Œå–„çš„é”™è¯¯å¤„ç†ä¸æ¢å¤æœºåˆ¶ï¼Œæ”¯æŒè®¾å¤‡çƒ­æ’æ‹”
- **7x24 è¿è¡Œ**: MTBF > 10000 å°æ—¶

### å¯ç»´æŠ¤æ€§
- **è·¨å¹³å°æŠ½è±¡**: æ ¸å¿ƒé€»è¾‘ä¸å¹³å° API è§£è€¦
- **æ¨¡å—åŒ–è®¾è®¡**: æ”¯æŒæ’ä»¶å¼æ‰©å±•
- **å®Œå–„æ—¥å¿—**: åˆ†çº§æ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºé—®é¢˜æ’æŸ¥
- **è§„èŒƒç¼–ç **: éµå¾ªå·¥ä¸šçº§ç¼–ç è§„èŒƒ

## ç³»ç»Ÿæ¶æ„

### åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Application Layer (AI/App)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AI Inference  â”‚  â”‚ Video Encoder  â”‚  â”‚ Debug/Record/Display   â”‚  â”‚
â”‚  â”‚  (Subscriber)  â”‚  â”‚  (Subscriber)  â”‚  â”‚  (Subscriber)          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚ (OnFrame)         â”‚ (OnFrame)            â”‚ (OnFrame)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          v                  v                     v                 â”‚
â”‚                   Frame Broker Layer (Core)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    FrameBroker (Manager)                       â”‚  â”‚
â”‚  â”‚  - Subscription Registry (Weak Ptr)                             â”‚  â”‚
â”‚  â”‚  - Task Dispatcher & Priority Queue                             â”‚  â”‚
â”‚  â”‚  - Worker Thread Pool                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â†‘
                                        â”‚ (Publish)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Camera Source Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    CameraSource                                  â”‚  â”‚
â”‚  â”‚  - V4L2 Device Control (Open/Start/Stop)                        â”‚  â”‚
â”‚  â”‚  - Buffer Pool Management (DMA-BUF/mmap)                        â”‚  â”‚
â”‚  â”‚  - Capture Thread (Epoll Wait)                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â†‘
                                        â”‚ (Ioctl / Mmap)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Platform Abstraction Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PlatformEpoll â”‚  â”‚ PlatformThread â”‚  â”‚  PlatformLogger       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµå‘

```
Camera Hardware -> V4L2 Driver -> CameraSource -> FrameBroker -> Subscribers
     (DQBUF)       (DMA-BUF)      (FrameHandle)  (Dispatch)     (OnFrame)
```

### æ ¸å¿ƒç»„ä»¶

#### 1. CameraSource
- **èŒè´£**: è´Ÿè´£ Camera è®¾å¤‡çš„åˆå§‹åŒ–ã€å‚æ•°é…ç½®ã€æµæ§åŠåŸå§‹å¸§æ•°æ®çš„æ•è·
- **ç‰¹æ€§**: å¤šå®ä¾‹æ”¯æŒã€V4L2 å®Œæ•´å°è£…ã€Buffer é¢„åˆ†é…ä¸å¤ç”¨ã€è®¾å¤‡çƒ­æ’æ‹”æ”¯æŒ

#### 2. FrameBroker
- **èŒè´£**: ç³»ç»Ÿä¸­æ¢ï¼Œç®¡ç†è®¢é˜…å…³ç³»ï¼Œå°†å¸§æ•°æ®åˆ†å‘ç»™æ‰€æœ‰è®¢é˜…è€…
- **ç‰¹æ€§**: çº¿ç¨‹æ± è°ƒåº¦ã€å¼±å¼•ç”¨ç®¡ç†ã€ä¼˜å…ˆçº§é˜Ÿåˆ—ã€è®¢é˜…è¿‡æ»¤

#### 3. FrameHandle
- **èŒè´£**: å¸§æ•°æ®çš„å…ƒæ•°æ®æè¿°ç¬¦ï¼ŒåŒ…å«å†…å­˜å¥æŸ„è€Œéæ•°æ®æŒ‡é’ˆ
- **ç‰¹æ€§**: C é£æ ¼ POD ç»“æ„ã€æ”¯æŒ Stride å’Œå¤šå¹³é¢æ ¼å¼ã€é›¶æ‹·è´ä¼ è¾“

#### 4. PlatformLayer
- **èŒè´£**: å°è£…æ“ä½œç³»ç»Ÿç›¸å…³æ¥å£ï¼ˆEpoll, Thread, Logï¼‰
- **ç‰¹æ€§**: è·¨å¹³å°é€‚é…ã€ç»Ÿä¸€é”™è¯¯ç ã€èµ„æºæŠ½è±¡

## æŠ€æœ¯æ ˆ

### å¼€å‘è¯­è¨€
- **C++17**: æ¡†æ¶å±‚ï¼Œæä¾›é¢å‘å¯¹è±¡å’Œç°ä»£ C++ ç‰¹æ€§
- **C (POD)**: æ•°æ®å±‚ï¼Œç¡®ä¿è·¨è¯­è¨€å…¼å®¹æ€§å’Œé›¶æ‹·è´ä¼ è¾“

### æ ¸å¿ƒä¾èµ–
- **spdlog**: é«˜æ€§èƒ½ C++ æ—¥å¿—åº“
- **pthread**: POSIX çº¿ç¨‹åº“
- **V4L2**: Linux è§†é¢‘è®¾å¤‡é©±åŠ¨æ¥å£

### æµ‹è¯•æ¡†æ¶
- **Google Test**: C++ å•å…ƒæµ‹è¯•æ¡†æ¶

### æ„å»ºå·¥å…·
- **CMake**: è·¨å¹³å°æ„å»ºç³»ç»Ÿ

## æ€§èƒ½æŒ‡æ ‡

### ååé‡
- æ”¯æŒ 4K@60fps ç¨³å®šé‡‡é›†
- å¤šè·¯å¹¶å‘é‡‡é›†èƒ½åŠ›ï¼ˆç¤ºä¾‹: 12/16 è·¯ 1080p@30fpsï¼‰
- å¤šè®¢é˜…è€…åŒæ—¶æ¶ˆè´¹èƒ½åŠ›

### å»¶è¿Ÿ
- ç«¯åˆ°ç«¯å»¶è¿Ÿ < 10ms (4K@30fps)
- é‡‡é›†å»¶è¿Ÿ < 2ms
- åˆ†å‘å»¶è¿Ÿ < 3ms

### èµ„æºå ç”¨
- å•è·¯ 4K@30fps å†…å­˜å ç”¨ < 100MB
- CPU å ç”¨ç‡ < 30% (å•æ ¸)
- æ— å†…å­˜æ³„æ¼

### ç¨³å®šæ€§
- 7x24 å°æ—¶ç¨³å®šè¿è¡Œ
- MTBF > 10000 å°æ—¶
- æ”¯æŒè®¾å¤‡çƒ­æ’æ‹”

## é€‚ç”¨åœºæ™¯

### åŒ…å«çš„åŠŸèƒ½
- Camera è®¾å¤‡ç®¡ç†ï¼ˆè®¾å¤‡å‘ç°ã€æ‰“å¼€ã€é…ç½®ã€å…³é—­ï¼‰
- V4L2 æµæ§ï¼ˆæ ¼å¼åå•†ã€Buffer ç®¡ç†ã€æµæ§åˆ¶ï¼‰
- å¸§æ•°æ®å°è£…ï¼ˆFrameHandle æ„å»ºã€å…ƒæ•°æ®ç®¡ç†ï¼‰
- è¿›ç¨‹å†…é«˜æ€§èƒ½åˆ†å‘ï¼ˆå‘å¸ƒè®¢é˜…ã€ä»»åŠ¡é˜Ÿåˆ—ã€çº¿ç¨‹æ± ï¼‰
- çº¿ç¨‹æ± ç®¡ç†ï¼ˆä»»åŠ¡è°ƒåº¦ã€è´Ÿè½½å‡è¡¡ï¼‰
- å¹³å°æŠ½è±¡å±‚ï¼ˆEpollã€Threadã€Log è·¨å¹³å°å°è£…ï¼‰

### ä¸åŒ…å«çš„åŠŸèƒ½
- å…·ä½“çš„ AI ç®—æ³•å®ç°
- éŸ³è§†é¢‘ç¼–ç åè®®å®ç°ï¼ˆå¦‚ H.264/H.265 ç¼–ç å™¨å†…éƒ¨é€»è¾‘ï¼‰
- è·¨è¿›ç¨‹é€šä¿¡ï¼ˆIPCï¼‰æœºåˆ¶
- UI æ¸²æŸ“é€»è¾‘
- ç½‘ç»œä¼ è¾“åè®®

## ç¼–ç è§„èŒƒ

### å‘½åè§„èŒƒ
- **ç±»å**: å¤§é©¼å³° (PascalCase) - ä¾‹å¦‚: `CameraSource`, `FrameBroker`
- **å‡½æ•°å**: å¤§é©¼å³° (PascalCase) - ä¾‹å¦‚: `StartStreaming()`, `Publish()`
- **æˆå‘˜å˜é‡**: å°å†™ + ä¸‹åˆ’çº¿åç¼€ - ä¾‹å¦‚: `device_fd_`, `is_running_`
- **å±€éƒ¨å˜é‡**: å°å†™ + ä¸‹åˆ’çº¿ - ä¾‹å¦‚: `frame_count`, `buffer_ptr`
- **å¸¸é‡**: k å‰ç¼€ + å¤§é©¼å³° - ä¾‹å¦‚: `kMaxBufferCount = 4`

### ä»£ç æ ¼å¼
- **ç¼©è¿›**: 4 ä¸ªç©ºæ ¼
- **å¤§æ‹¬å·**: ç‹¬ç«‹å ä¸€è¡Œ
- **è¡Œå®½**: ä¸è¶…è¿‡ 100 å­—ç¬¦
- **ç©ºè¡Œ**: å‡½æ•°ä¹‹é—´ç©º 2 è¡Œï¼Œé€»è¾‘å—ä¹‹é—´ç©º 1 è¡Œ

### æ³¨é‡Šè§„èŒƒ
- ä½¿ç”¨ Doxygen é£æ ¼æ³¨é‡Š
- æ–‡ä»¶å¤´æ³¨é‡Šï¼šåŒ…å«æ–‡ä»¶åã€ç®€ä»‹ã€ä½œè€…ã€æ—¥æœŸ
- ç±»æ³¨é‡Šï¼šæè¿°ç±»çš„èŒè´£å’Œç”¨é€”
- å‡½æ•°æ³¨é‡Šï¼šåŒ…å«å‚æ•°è¯´æ˜ã€è¿”å›å€¼ã€æ³¨æ„äº‹é¡¹

## é¡¹ç›®çŠ¶æ€

### å½“å‰ç‰ˆæœ¬
- **ç‰ˆæœ¬å·**: v0.1
- **çŠ¶æ€**: å¼€å‘ä¸­
- **å®Œæˆåº¦**: çº¦ 55%

### å·²å®Œæˆæ¨¡å—
- âœ… æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡
- âœ… å¹³å°æŠ½è±¡å±‚å®ç°
- âœ… åˆ†å‘å±‚å®ç°ï¼ˆFrameBrokerï¼‰
- âœ… ä¿¡å·å¤„ç†å·¥å…·ï¼ˆutils/signal_handlerï¼‰
- âœ… CameraSourceï¼ˆV4L2 + MMAP é‡‡é›†ï¼‰
- âœ… æ„å»ºç³»ç»Ÿé…ç½®
- âœ… å•å…ƒæµ‹è¯•æ¡†æ¶
- âœ… å‹æµ‹ç¨‹åºï¼ˆPlatformLayer / FrameBroker / CameraSourceï¼‰

### è¿›è¡Œä¸­æ¨¡å—
- ğŸš§ CameraSource é«˜çº§èƒ½åŠ›ï¼ˆå¤šå¹³é¢ / DMA-BUFï¼‰

### è®¡åˆ’ä¸­æ¨¡å—
- â³ å·¥å…·ç±»å®ç°
- â³ é›†æˆæµ‹è¯•
- â³ æ€§èƒ½æµ‹è¯•
- â³ ç¤ºä¾‹ä»£ç 

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Ubuntu 18.04+ / Debian 10+
- GCC 7.0+ (æ”¯æŒ C++17)
- CMake 3.10+
- spdlogï¼ˆæ¨èä»¥ third_party æ–¹å¼é›†æˆï¼‰
- Google Testï¼ˆæ¨èä»¥ third_party/googletest æ–¹å¼é›†æˆï¼‰

### spdlog å®‰è£…ä¸é›†æˆï¼ˆæ¨èï¼‰

æœ¬é¡¹ç›®çš„ CMake å·²æ”¯æŒä»¥ä¸‹ä¼˜å…ˆçº§ï¼š
1. `find_package(spdlog CONFIG)`ï¼ˆç³»ç»Ÿå·²å®‰è£…æ—¶ï¼‰
2. `third_party/spdlog`ï¼ˆæ¨èï¼‰
3. `third_party/spdlog_stub`ï¼ˆä»…å…œåº•ï¼‰

æ¨èå°† spdlog ä½œä¸ºå­æ¨¡å—æ”¾å…¥ `third_party/spdlog`ï¼š

```bash
# åœ¨ä»“åº“æ ¹ç›®å½•æ‰§è¡Œ
git submodule add https://github.com/gabime/spdlog.git third_party/spdlog
git submodule update --init --recursive
```

å¯é€‰æ–¹æ¡ˆï¼ˆç³»ç»Ÿå®‰è£…ï¼Œé€‚åˆ CI / ç»Ÿä¸€ç¯å¢ƒï¼‰ï¼š

```bash
sudo apt-get update
sudo apt-get install -y libspdlog-dev
```

å®Œæˆä¸Šè¿°ä»»ä¸€æ–¹å¼åï¼Œç›´æ¥æ„å»ºå³å¯ï¼š

```bash
rm -rf build
./scripts/build.sh
```

### Google Test å®‰è£…ä¸é…ç½®ï¼ˆæ¨èï¼‰

æœ¬é¡¹ç›®çš„ CMake å·²æ”¯æŒä»¥ä¸‹ä¼˜å…ˆçº§ï¼š
1. `find_package(GTest CONFIG)`ï¼ˆç³»ç»Ÿå·²å®‰è£…æ—¶ï¼‰
2. `third_party/googletest`ï¼ˆæ¨èï¼‰
3. æœªæ‰¾åˆ°æ—¶è·³è¿‡æµ‹è¯•ç›®æ ‡ï¼ˆä¸å½±å“åº“æ„å»ºï¼‰

æ¨èå°† googletest ä½œä¸ºå­æ¨¡å—æ”¾å…¥ `third_party/googletest`ï¼š

```bash
# åœ¨ä»“åº“æ ¹ç›®å½•æ‰§è¡Œ
git submodule add https://github.com/google/googletest.git third_party/googletest
git submodule update --init --recursive
```

å¯é€‰æ–¹æ¡ˆï¼ˆç³»ç»Ÿå®‰è£…ï¼Œé€‚åˆ CI / ç»Ÿä¸€ç¯å¢ƒï¼‰ï¼š

```bash
sudo apt-get update
sudo apt-get install -y libgtest-dev
```

å®Œæˆé…ç½®åï¼Œå»ºè®®å…¨é‡é‡æ–°æ„å»ºå¹¶æ‰§è¡Œæµ‹è¯•ï¼š

```bash
rm -rf build
./scripts/build.sh
cd build
ctest --output-on-failure
```

### ç¼–è¯‘æ­¥éª¤

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/SuycxZMZ/CameraSubsystem.git
cd CameraSubsystem

# ç¼–è¯‘é¡¹ç›®
./scripts/build.sh

# è¿è¡Œæµ‹è¯•ï¼ˆéœ€å·²é…ç½® Google Testï¼‰
cd build
ctest --output-on-failure
```

### ä½¿ç”¨ç¤ºä¾‹

```cpp
#include "camera_subsystem/core/camera_config.h"
#include "camera_subsystem/broker/frame_subscriber.h"

using namespace camera_subsystem;

// åˆ›å»ºè®¢é˜…è€…
class MySubscriber : public broker::IFrameSubscriber
{
public:
    void OnFrame(const core::FrameHandle& frame) override
    {
        // å¤„ç†å¸§æ•°æ®
        printf("Received frame: %u\n", frame.frame_id_);
    }

    const char* GetSubscriberName() const override
    {
        return "MySubscriber";
    }
};

int main()
{
    // åˆå§‹åŒ–æ—¥å¿—ç³»ç»Ÿ
    platform::PlatformLogger::Initialize("camera.log", core::LogLevel::kInfo);

    // åˆ›å»ºé…ç½®
    core::CameraConfig config = core::CameraConfig::GetDefault();

    // TODO: åˆ›å»º CameraSource å’Œ FrameBroker
    // TODO: æ³¨å†Œè®¢é˜…è€…
    // TODO: å¼€å§‹é‡‡é›†

    return 0;
}
```

## è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

### ä»£ç è§„èŒƒ
- éµå¾ªé¡¹ç›®çš„ç¼–ç è§„èŒƒï¼ˆè¯¦è§ NAMING_CONVENTION.mdï¼‰
- æ·»åŠ é€‚å½“çš„å•å…ƒæµ‹è¯•
- æ›´æ–°ç›¸å…³æ–‡æ¡£
- ç¡®ä¿æ‰€æœ‰æµ‹è¯•é€šè¿‡

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

- **é¡¹ç›®ç»´æŠ¤è€…**: CameraSubsystem Team
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/yourusername/CameraSubsystem/issues)
- **æ–‡æ¡£**: [é¡¹ç›®æ–‡æ¡£](https://github.com/yourusername/CameraSubsystem/tree/main/docs)

## è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰ä¸ºæœ¬é¡¹ç›®åšå‡ºè´¡çŒ®çš„å¼€å‘è€…ï¼

---

**æœ€åæ›´æ–°**: 2026-01-28
**æ–‡æ¡£ç‰ˆæœ¬**: v0.1
